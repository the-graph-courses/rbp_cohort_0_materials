---
title: "Exercise instructions + example report"
output: prettydoc::html_pretty
author: "Group member 1 and group member 2"
date: "2022-10-25"
editor_options: 
  chunk_output_type: console
---

```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE)

# packages
if(!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, here, patchwork, janitor, esquisse, flextable)
```

## Instructions

This work is to be done in groups of 2 or 3. You are allowed to pick your own partners. Proceed into any of the small pair rooms to work. You are encouraged to do the initial work locally, work either on RStudio Cloud or locally.

1.  First download the course repo here: then open the week_03 folder.

2.  You and your group partner should pick one of the five datasets in the "week_03/data" folder.

    -   You can read through the document titled "00_info_about_each_dataset" to get information about the datasets.

3.  Then each member of the group should **pick any categorical variable** from that dataset. Your task is to create a short R-Markdown-based HTML report showing the frequency distribution of this variable across two sexes.

    For example, Jane and John pick the India TB data. Jane chooses to look at the differences in the education variable between men and women. John chooses to look at the distribution of the employment variable between men and women. Their document

4.  Each section of the report should contain:

    a.  A plot created with {ggplot2}/{esquisse}

    b.  A table created with {flextable} (Your table should have a caption/title. See the flextable book for tips: <https://ardata-fr.github.io/flextable-book/>)

    c.  At least one use of inline R code within the Rmd.

    d.  A mention of at least one way that the report could be improved.

5.  Since RStudio cloud caused some problems in the last session (specifically with esquisse), it is recommended that you first work on your local RStudio, then when you are finished, you can copy your Rmd lines into RStudio Cloud, and do the final render from there. (Alternatively, you can copy all the material onto one of the group member's computers, and perform the final render from there).

6.  By the end of the session, a single person from the group will present the work done. Note that your work does not have to be finished by the end of the lesson. You'll just present what you have so far. The final due date is Tuesday, Nov 1 at 3pm CET.

Note that your work will be judged simply on whether you have the requirements spelled out above

The rest of this document is an example of what one section of a report might look like..

# Workshop 3 Assignment: Colombia Car Accidents data

## Age distribution of fatalities per sex group

**Work primarily done by group member 1**

This dataset provides information on deaths due to motorcycle accidents in some Colombian cities, as recorded in medical and police certificates.

```{r cars}
col_accidents <- read_csv(here("week_03/data/03_motorcycle_accidents_colombia.csv"))
```

I chose to look at the difference in age groups between male and female victims.

The plot below shows the different age distributions:

```{r echo = F}
esquisse::esquisser(col_accidents)

male <-
  col_accidents %>%
  filter(REC_SEXO %in% "Masculino") %>%
  ggplot() +
  aes(x = `REC_GRUPO EDAD`) +
  geom_bar(fill = "#678BCB") +
  labs(title = "Age group distribution of fatalities from motorcycle accidents",
       subtitle = "(Men)") +
  theme_minimal() +
  theme(plot.title = element_text(size = 20L, face = "bold"),
        plot.subtitle = element_text(size = 15L))
  
  
female <-
  col_accidents %>%
  filter(REC_SEXO %in% "Femenino") %>%
  ggplot() +
  aes(x = `REC_GRUPO EDAD`) +
  geom_bar(fill = "#A4BBB6") +
  labs(subtitle = "(Women)") +
  theme_minimal() +
  theme(plot.title = element_text(size = 20L,
                                  face = "bold"),
        plot.subtitle = element_text(size = 15L))


male + female
# alternatively: male / female

```

*Teacher commentary: We have not yet learned how to create dodged/faceted bar charts, which would be best for showing differences between genders. So for now, you should use the + and / syntax from the patchwork package to combine two plots, one for each sex.*

And the table below shows similar information:

```{r}
freq_table <- tabyl(col_accidents, `REC_GRUPO EDAD`, REC_SEXO)
flex <- flextable(freq_table)
flex_with_caption <- set_caption(flex, caption = "Age group distribution of fatalities from motorcycle accidents")
flex_with_caption
```

As see in the figure and plot, there were more deaths in men than in women.

For both sexes, the age group with the most deaths was the 20 to 24 age group. In women, there were `r freq_table[4,2]` deaths in this age group, and in men there were `r freq_table[4,3]` deaths.

*Teacher commentary: We have not yet learned how to extract data specific slices of data from a data frame. For now, you should use the syntax demonstrated above: within a pair of square brackets, place the row number, a comma, then the column number.*

**Issues to be fixed:**

-   The two bar charts have different numbers of bars. This is not ideal.
-   The age group labels are a bit too horizontally compressed.
-   I do not yet know how to change the variable names, so I left in the `REC_GRUPO EDAD` name in the table and plot.

## Distribution of roles (passenger, driver or other), per sex group

**Work primarily done by group member 2**

*Teacher commentary: Note that once the work has been done for one variable, it is easy to copy and paste the code to reproduce the analyses on another variable.*
